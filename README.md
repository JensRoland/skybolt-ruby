# Skybolt Ruby

High-performance asset caching for multi-page applications.

## Installation

Add to your Gemfile:

```ruby
gem "skybolt-ruby"
```

Then run:

```bash
bundle install
```

## Usage

```ruby
require "skybolt"

# Initialize with render map path and cookies
sb = Skybolt::Renderer.new(
  "public/dist/.skybolt/render-map.json",
  cookies: request.cookies
)

# In your template:
# Critical CSS (in <head>)
sb.css("src/css/critical.css")

# Launch script (in <head>, after critical CSS)
sb.launch_script

# Main CSS
sb.css("src/css/main.css")

# JavaScript (before </body>)
sb.script("src/js/app.js")
```

## Rails Integration

```ruby
# app/helpers/skybolt_helper.rb
module SkyboltHelper
  def skybolt
    @skybolt ||= Skybolt::Renderer.new(
      Rails.root.join("public/dist/.skybolt/render-map.json").to_s,
      cookies: cookies.to_h
    )
  end
end
```

```erb
<%# app/views/layouts/application.html.erb %>
<!DOCTYPE html>
<html>
<head>
  <%= raw skybolt.css("app/assets/stylesheets/critical.css") %>
  <%= raw skybolt.launch_script %>
  <%= raw skybolt.css("app/assets/stylesheets/application.css") %>
</head>
<body>
  <%= yield %>
  <%= raw skybolt.script("app/javascript/application.js") %>
</body>
</html>
```

## Sinatra Integration

```ruby
require "sinatra"
require "skybolt"

helpers do
  def skybolt
    @skybolt ||= Skybolt::Renderer.new(
      "public/dist/.skybolt/render-map.json",
      cookies: request.cookies
    )
  end
end

get "/" do
  erb :index
end
```

## API Reference

### `Skybolt::Renderer.new(render_map_path, cookies: nil, cdn_url: nil)`

Create a new Skybolt renderer.

- `render_map_path`: Path to render-map.json generated by Vite plugin
- `cookies`: Cookie hash (optional)
- `cdn_url`: Optional CDN URL prefix

### `css(entry) -> String`

Render CSS asset. Returns HTML string.

### `script(entry, is_module: true) -> String`

Render JavaScript asset. Returns HTML string.

### `launch_script -> String`

Render the Skybolt client launcher script. Call once in `<head>`.

### `preload(entry, as_type:, type: nil, crossorigin: nil, fetchpriority: nil) -> String`

Render preload link for critical resources.

### `asset_url(entry) -> String?`

Get URL for an asset (for manual use cases).

### `asset_hash(entry) -> String?`

Get hash for an asset (for manual use cases).

## License

MIT
